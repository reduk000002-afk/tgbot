<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Фьючерсный терминал</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      overflow-x: hidden;
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #0d1117;
      color: #c9d1d9;
      -webkit-text-size-adjust: 100%;
    }

    .header-bar {
      display: flex;
      justify-content: space-between;
      background: #161b22;
      padding: 10px 20px;
      border-bottom: 1px solid #30363d;
      position: sticky;
      top: 0;
      z-index: 101;
      font-size: 14px;
      align-items: center;
      height: 60px;
    }

    .balance-info {
      display: flex;
      gap: 20px;
    }

    .balance-item {
      display: flex;
      flex-direction: column;
    }

    .balance-label {
      color: #8b949e;
      font-size: 12px;
      margin-bottom: 3px;
    }

    .balance-value {
      font-weight: bold;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .positive {
      color: #16c784;
    }

    .negative {
      color: #ea3943;
    }

    .login-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(13, 17, 23, 0.95);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .login-form {
      background: #161b22;
      padding: 30px;
      border-radius: 10px;
      border: 1px solid #30363d;
      width: 90%;
      max-width: 400px;
    }

    .login-form h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    .login-form input {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      background: #0d1117;
      border: 1px solid #30363d;
      color: white;
      border-radius: 5px;
      font-size: 14px;
    }

    .login-form button {
      width: 100%;
      padding: 12px;
      background-color: #1f6feb;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 14px;
      cursor: pointer;
    }

    .login-error {
      color: #f85149;
      text-align: center;
      margin-top: 10px;
      font-size: 14px;
      display: none;
    }

    .register-link {
      text-align: center;
      margin-top: 15px;
      font-size: 14px;
    }

    .register-link a {
      color: #1f6feb;
      text-decoration: none;
    }

    .main-container {
      display: flex;
      min-height: calc(100vh - 60px);
    }

    .market-column {
      width: 280px;
      background: #161b22;
      border-right: 1px solid #30363d;
      padding: 15px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .layout {
      display: flex;
      flex-direction: column;
      flex: 1;
    }

    .sidebar {
      display: flex;
      flex-direction: row;
      justify-content: space-around;
      background: #161b22;
      padding: 10px 0;
      border-bottom: 1px solid #30363d;
      position: sticky;
      top: 60px;
      z-index: 100;
    }

    .sidebar-item {
      text-align: center;
      font-size: 12px;
      color: #c9d1d9;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 60px;
      padding: 5px;
      border-radius: 5px;
      transition: background-color 0.2s;
    }

    .sidebar-item:hover, .sidebar-item.active {
      background-color: #21262d;
    }

    .sidebar-item img {
      width: 20px;
      height: 20px;
      margin-bottom: 5px;
    }

    .page-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: none;
    }

    .page-content.active {
      display: block;
    }

    .chart-section {
      background: #0d1117;
      position: relative;
      display: flex;
      flex-direction: column;
      height: 50vh;
      border: 1px solid #30363d;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .chart-section iframe {
      flex: 1;
      width: 100%;
      border: none;
      min-height: 300px;
      border-radius: 0 0 8px 8px;
    }

    .deal-display {
      background: #0d1117;
      border-top: 1px solid #30363d;
      padding: 15px;
      font-family: monospace;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 30vh;
      overflow-y: auto;
    }

    .deal-row {
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 13px;
    }

    .deal-column {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .terminal-section {
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 15px;
      overflow-y: auto;
      transition: transform 0.3s ease, margin-top 0.3s ease;
    }

    .selector-container {
      margin-bottom: 15px;
      position: relative;
      width: 100%;
    }

    .selector-button {
      width: 100%;
      padding: 12px;
      background: #0d1117;
      color: white;
      border: 1px solid #30363d;
      border-radius: 8px;
      text-align: left;
      cursor: pointer;
      font-size: 14px;
    }

    .dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: rgba(22, 27, 34, 0.95);
      border: 1px solid #30363d;
      border-radius: 8px;
      max-height: 200px;
      overflow-y: auto;
      display: none;
      z-index: 100;
    }

    .dropdown input {
      width: 100%;
      padding: 10px;
      background: #0d1117;
      color: white;
      border: none;
      border-bottom: 1px solid #30363d;
      font-size: 14px;
    }

    .dropdown div {
      padding: 10px;
      cursor: pointer;
      font-size: 14px;
    }

    .dropdown div:hover {
      background: #21262d;
    }

    .terminal-section select,
    .terminal-section input[type="number"] {
      width: 100%;
      padding: 12px;
      background: #0d1117;
      border: 1px solid #30363d;
      color: white;
      border-radius: 5px;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .btn {
      width: 100%;
      padding: 12px;
      font-size: 14px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-bottom: 10px;
      transition: opacity 0.2s;
    }

    .btn:hover {
      opacity: 0.9;
    }

    .btn-long {
      background-color: #16c784;
      color: white;
    }

    .btn-short {
      background-color: #ea3943;
      color: white;
    }

    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 15px;
    }

    .checkbox-group label {
      display: flex;
      align-items: center;
      font-size: 14px;
      gap: 8px;
    }

    .checkbox-group input {
      width: 18px;
      height: 18px;
    }

    .tp-sl {
      display: none;
      margin-bottom: 10px;
    }

    .tp-sl input {
      width: 100%;
      margin-bottom: 8px;
      padding: 10px;
    }

    .flex-space {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .info-line {
      font-size: 13px;
      margin-bottom: 8px;
    }

    .leverage-display {
      text-align: center;
      margin: 5px 0 15px;
      font-size: 14px;
    }

    .market-info {
      background: #161b22;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 15px;
      border: 1px solid #30363d;
    }

    .market-info div {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .market-info div:last-child {
      margin-bottom: 0;
    }

    .title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 15px;
    }

    .positions-title {
      padding: 10px 15px;
      font-weight: bold;
      border-bottom: 1px solid #30363d;
      background: #161b22;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .positions-title::after {
      content: "▼";
      font-size: 12px;
      transition: transform 0.3s;
    }

    .positions-title.expanded::after {
      transform: rotate(180deg);
    }

    .deal-block {
      border-bottom: 1px solid #30363d;
      padding: 10px 15px;
      transition: background-color 0.2s;
    }

    .deal-block:hover {
      background-color: #161b22;
    }

    .section-title {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #8b949e;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .watchlist-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #21262d;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .watchlist-item:hover {
      background-color: #21262d;
    }

    .asset-name {
      font-weight: bold;
      font-size: 14px;
    }

    .asset-price {
      font-size: 14px;
    }

    .asset-change {
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 3px;
    }

    .quick-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .quick-btn {
      background: #21262d;
      border: 1px solid #30363d;
      color: #c9d1d9;
      padding: 8px;
      border-radius: 5px;
      cursor: pointer;
      text-align: center;
      font-size: 12px;
      transition: background-color 0.2s;
    }

    .quick-btn:hover {
      background: #30363d;
    }

    .portfolio-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .portfolio-bar {
      height: 6px;
      background: #30363d;
      border-radius: 3px;
      margin-top: 5px;
      overflow: hidden;
    }

    .portfolio-fill {
      height: 100%;
      border-radius: 3px;
    }

    .market-stats {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      margin-top: 5px;
    }

    .stat-item {
      text-align: center;
    }

    .stat-value {
      font-weight: bold;
      font-size: 14px;
    }

    .stat-label {
      color: #8b949e;
    }

    .profile-container {
      max-width: 900px;
      margin: 0 auto;
      background: #161b22;
      padding: 30px;
      border: 1px solid #30363d;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .profile-section {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-top: 25px;
      border-top: 1px solid #30363d;
      padding-top: 20px;
    }

    .profile-column {
      flex: 1;
      margin: 10px;
      min-width: 300px;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 12px 0;
      padding: 10px 0;
      border-bottom: 1px solid #21262d;
    }

    .label {
      font-weight: 600;
      color: #8b949e;
    }

    .profile-btn {
      background-color: #238636;
      border: none;
      padding: 10px 18px;
      color: white;
      cursor: pointer;
      border-radius: 6px;
      font-weight: 600;
      transition: background-color 0.2s;
      font-size: 14px;
    }

    .profile-btn:hover {
      background-color: #2ea043;
    }

    .btn-secondary {
      background-color: #21262d;
      border: 1px solid #30363d;
    }

    .btn-secondary:hover {
      background-color: #30363d;
    }

    .btn-kyc {
      background-color: #1f6feb;
      width: 100%;
      padding: 12px;
      margin-top: 10px;
    }

    .btn-kyc:hover {
      background-color: #2b7ff5;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-verified {
      background-color: rgba(35, 134, 54, 0.2);
      color: #3fb950;
    }

    .status-pending {
      background-color: rgba(187, 128, 9, 0.2);
      color: #d29922;
    }

    .kyc-message {
      background-color: #0d1117;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      font-size: 14px;
      line-height: 1.5;
    }

    .file-upload {
      display: flex;
      flex-direction: column;
      margin-bottom: 15px;
    }

    .file-upload label {
      margin-bottom: 8px;
      font-weight: 500;
      color: #8b949e;
    }

    .file-input {
      background-color: #0d1117;
      color: white;
      border: 1px solid #30363d;
      padding: 10px;
      border-radius: 6px;
      font-size: 14px;
    }

    .user-id {
      display: flex;
      align-items: center;
      background-color: #0d1117;
      border: 1px solid #30363d;
      border-radius: 6px;
      padding: 12px 15px;
      margin-bottom: 20px;
    }

    .balance-info-section {
      background: #161b22;
      padding: 25px;
      border: 1px solid #30363d;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .balance-warning {
      color: #f85149;
      background: rgba(248, 81, 73, 0.1);
      padding: 12px 15px;
      border-radius: 8px;
      margin-bottom: 25px;
      font-size: 14px;
      border: 1px solid rgba(248, 81, 73, 0.3);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .wallet-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .wallet-tab {
      background: #21262d;
      padding: 12px 18px;
      border-radius: 8px;
      border: 1px solid #30363d;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .wallet-tab:hover {
      background: #30363d;
    }

    .wallet-tab.active {
      background: #1f6feb;
      border-color: #1f6feb;
      box-shadow: 0 2px 8px rgba(31, 111, 235, 0.3);
    }

    .wallet-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .wallet-content.active {
      display: block;
    }

    .qr-code-container {
      text-align: center;
      margin: 20px 0;
      padding: 20px;
      background: #0d1117;
      border-radius: 10px;
      border: 1px solid #30363d;
    }

    .wallet-address {
      background: #161b22;
      padding: 12px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      word-break: break-all;
      margin: 15px 0;
      text-align: center;
      font-size: 14px;
      border: 1px solid #30363d;
      color: #f0f6fc;
    }

    .wallet-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 20px;
    }

    .wallet-btn {
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      border: none;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s ease;
      min-width: 140px;
    }

    .copy-btn {
      background-color: #1f6feb;
      color: white;
      border: 1px solid #1f6feb;
    }

    .copy-btn:hover {
      background-color: #2b7ff5;
      box-shadow: 0 2px 8px rgba(31, 111, 235, 0.3);
    }

    .copy-btn.copied {
      background-color: #238636;
      border-color: #238636;
    }

    .history-section {
      background: #161b22;
      padding: 25px;
      border: 1px solid #30363d;
      border-radius: 10px;
      margin-top: 25px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .history-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    .history-table th {
      text-align: left;
      padding: 12px 15px;
      border-bottom: 1px solid #30363d;
      color: #58a6ff;
      font-weight: 600;
      font-size: 13px;
    }

    .history-table td {
      padding: 12px 15px;
      border-bottom: 1px solid #21262d;
      color: #f0f6fc;
    }

    .empty-history {
      text-align: center;
      padding: 40px 20px;
      color: #8b949e;
      font-size: 14px;
    }

    .network-info {
      color: #8b949e;
      font-size: 13px;
      margin-top: 5px;
      text-align: center;
    }

    .withdraw-alert {
      color: #f85149;
      background: rgba(248, 81, 73, 0.1);
      padding: 15px;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 25px;
      border: 1px solid rgba(248, 81, 73, 0.3);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .withdraw-form {
      background: #161b22;
      padding: 25px;
      border-radius: 10px;
      border: 1px solid #30363d;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      margin-bottom: 30px;
    }

    .withdraw-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
    }

    .withdraw-tab {
      padding: 12px 20px;
      background: #21262d;
      border: 1px solid #30363d;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .withdraw-tab:hover {
      background: #30363d;
    }

    .withdraw-tab.active {
      background: #1f6feb;
      color: white;
      border-color: #1f6feb;
      box-shadow: 0 2px 8px rgba(31, 111, 235, 0.3);
    }

    .form-section {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .form-section.active {
      display: block;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      margin-bottom: 20px;
    }

    .form-group label {
      margin-bottom: 8px;
      font-weight: 500;
      color: #8b949e;
      font-size: 14px;
    }

    .form-group input {
      padding: 12px 15px;
      border: 1px solid #30363d;
      border-radius: 8px;
      background: #0d1117;
      color: #f0f6fc;
      font-size: 14px;
      transition: border-color 0.2s;
    }

    .submit-btn {
      background: #1f6feb;
      color: white;
      padding: 14px 20px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 100%;
      margin-top: 10px;
    }

    .balance-display {
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .balance-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #21262d;
    }

    .balance-row:last-child {
      border-bottom: none;
    }

    .balance-label {
      color: #8b949e;
      font-size: 14px;
    }

    .balance-amount {
      font-size: 16px;
      font-weight: 600;
      color: #f0f6fc;
    }

    .total-balance {
      background: linear-gradient(135deg, #1f6feb, #2b7ff5);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
    }

    .total-balance-label {
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
      margin-bottom: 8px;
    }

    .total-balance-amount {
      font-size: 28px;
      font-weight: 700;
      color: white;
    }

    .balance-currency {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
      margin-left: 5px;
    }

    .available-balance {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .available-balance-label {
      color: #8b949e;
      font-size: 13px;
      margin-bottom: 5px;
    }

    .available-balance-amount {
      font-size: 18px;
      font-weight: 600;
      color: #f0f6fc;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      z-index: 10000;
    }

    .modal-overlay.active {
      display: block;
    }

    .modal {
      background: #161b22;
      border-radius: 12px;
      border: 1px solid #30363d;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      animation: modalAppear 0.3s ease;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10001;
    }

    .modal-header {
      padding: 20px 25px;
      border-bottom: 1px solid #30363d;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      color: #f0f6fc;
      font-size: 18px;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      color: #8b949e;
      font-size: 20px;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: background-color 0.2s;
    }

    .modal-body {
      padding: 25px;
    }

    .modal-message {
      color: #c9d1d9;
      line-height: 1.6;
      margin-bottom: 20px;
    }

    .commission-warning {
      background: rgba(248, 81, 73, 0.1);
      border: 1px solid rgba(248, 81, 73, 0.3);
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }

    .commission-list {
      list-style: none;
      margin: 15px 0;
    }

    .commission-list li {
      padding: 5px 0;
      color: #8b949e;
    }

    .commission-total {
      font-weight: 600;
      color: #f85149 !important;
      font-size: 15px;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #30363d;
    }

    .modal-footer {
      padding: 20px 25px;
      border-top: 1px solid #30363d;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .modal-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .modal-btn-cancel {
      background: #21262d;
      color: #c9d1d9;
      border: 1px solid #30363d;
    }

    .modal-btn-confirm {
      background: #1f6feb;
      color: white;
    }

    .checkbox-container {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin: 20px 0;
      padding: 15px;
      background: rgba(248, 81, 73, 0.05);
      border-radius: 8px;
      border: 1px solid rgba(248, 81, 73, 0.2);
    }

    .support-message {
      text-align: center;
      padding: 20px 0;
    }

    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #f85149;
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      z-index: 9999;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      display: none;
      animation: slideIn 0.3s ease;
    }

    .success-checkmark {
      text-align: center;
      margin: 20px 0;
    }

    .check-icon {
      width: 80px;
      height: 80px;
      position: relative;
      border-radius: 50%;
      box-sizing: content-box;
      border: 4px solid #16c784;
      margin: 0 auto;
    }

    .check-icon::before {
      top: 3px;
      left: -2px;
      width: 30px;
      transform-origin: 100% 50%;
      border-radius: 100px 0 0 100px;
    }

    .check-icon::after {
      top: 0;
      left: 30px;
      width: 60px;
      transform-origin: 0 50%;
      border-radius: 0 100px 100px 0;
      animation: rotate-circle 4.25s ease-in;
    }

    .check-icon::before, .check-icon::after {
      content: '';
      height: 100px;
      position: absolute;
      background: #161b22;
      transform: rotate(-45deg);
    }

    .icon-line {
      height: 5px;
      background-color: #16c784;
      display: block;
      border-radius: 2px;
      position: absolute;
      z-index: 10;
    }

    .icon-line.line-tip {
      top: 46px;
      left: 14px;
      width: 25px;
      transform: rotate(45deg);
      animation: icon-line-tip 0.75s;
    }

    .icon-line.line-long {
      top: 38px;
      right: 8px;
      width: 47px;
      transform: rotate(-45deg);
      animation: icon-line-long 0.75s;
    }

    .icon-circle {
      top: -4px;
      left: -4px;
      z-index: 10;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      position: absolute;
      box-sizing: content-box;
      border: 4px solid rgba(22, 199, 132, 0.5);
    }

    .icon-fix {
      top: 8px;
      width: 5px;
      left: 26px;
      z-index: 1;
      height: 85px;
      position: absolute;
      transform: rotate(-45deg);
      background-color: #161b22;
    }

    @keyframes rotate-circle {
      0% { transform: rotate(-45deg); }
      5% { transform: rotate(-45deg); }
      12% { transform: rotate(-405deg); }
      100% { transform: rotate(-405deg); }
    }

    @keyframes icon-line-tip {
      0% { width: 0; left: 1px; top: 19px; }
      54% { width: 0; left: 1px; top: 19px; }
      70% { width: 50px; left: -8px; top: 37px; }
      84% { width: 17px; left: 21px; top: 48px; }
      100% { width: 25px; left: 14px; top: 45px; }
    }

    @keyframes icon-line-long {
      0% { width: 0; right: 46px; top: 54px; }
      65% { width: 0; right: 46px; top: 54px; }
      84% { width: 55px; right: 0px; top: 35px; }
      100% { width: 47px; right: 8px; top: 38px; }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes modalAppear {
      from { opacity: 0; transform: translate(-50%, -60%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }

    @media (min-width: 768px) {
      .layout {
        flex-direction: row;
        height: calc(100vh - 60px);
      }
      
      .sidebar {
        flex-direction: column;
        justify-content: flex-start;
        width: 80px;
        height: calc(100vh - 60px);
        padding-top: 20px;
        gap: 30px;
        border-right: 1px solid #30363d;
        border-bottom: none;
        top: 60px;
      }
      
      .market-column {
        display: flex;
        width: 280px;
        height: calc(100vh - 60px);
      }
      
      .deal-row {
        flex-direction: row;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 20px;
      }
      
      .deal-column {
        min-width: 180px;
      }
      
      .flex-space {
        flex-direction: row;
        gap: 4%;
        flex-wrap: wrap;
      }

      .trade-layout {
        display: flex;
        gap: 20px;
        height: 100%;
      }

      .trade-main {
        flex: 2;
        display: flex;
        flex-direction: column;
      }

      .trade-terminal {
        width: 350px;
        height: 100%;
      }

      .positions-container {
        display: block;
        max-height: 300px;
        overflow-y: auto;
        background: #0d1117;
        border: 1px solid #30363d;
        border-radius: 8px;
        margin-top: 20px;
      }

      .mobile-positions-toggle {
        display: none;
      }

      .desktop-positions {
        display: block;
      }
    }

    @media (max-width: 767px) {
      .main-container {
        flex-direction: column;
      }

      .market-column {
        display: none;
      }

      .layout {
        flex-direction: column;
        height: auto;
      }

      .header-bar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 1000;
        padding: 10px 15px;
      }

      .sidebar {
        position: fixed;
        top: 60px;
        left: 0;
        width: 100%;
        height: auto;
        flex-direction: row;
        justify-content: space-around;
        align-items: center;
        padding: 10px 0;
        gap: 0;
        background: #161b22;
        border-right: none;
        border-bottom: 1px solid #30363d;
        z-index: 999;
      }

      .page-content {
        margin-top: 120px;
        padding: 15px;
      }

      .chart-section {
        height: 25vh;
        min-height: 200px;
      }

      .chart-section iframe {
        min-height: 150px;
      }

      .positions-container {
        display: none;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
      }

      .positions-container.expanded {
        display: block;
        max-height: 400px;
        overflow-y: auto;
        animation: fadeIn 0.3s ease;
      }

      .mobile-positions-toggle {
        display: block;
        margin-top: 15px;
      }

      .trade-layout {
        display: flex;
        flex-direction: column;
        gap: 0;
      }

      .trade-main {
        order: 1;
      }

      .trade-terminal {
        order: 2;
        margin-top: 20px;
        transition: transform 0.3s ease, margin-top 0.3s ease;
      }

      .trade-terminal.shifted {
        transform: translateY(100px);
        margin-top: 120px;
      }

      .desktop-positions {
        display: none;
      }
    }

    @media (max-width: 360px) {
      .trade-terminal.shifted {
        transform: translateY(80px);
        margin-top: 100px;
      }
    }
  </style>
</head>
<body>
<!-- Форма входа -->
<div id="loginContainer" class="login-container">
  <div class="login-form">
    <h2>Вход</h2>
    <input type="text" id="loginEmail" placeholder="Логин" required>
    <input type="password" id="loginPassword" placeholder="Пароль" required>
    <button onclick="checkLogin()">Войти</button>
    <div id="loginError" class="login-error">Неверный логин или пароль</div>
    <div class="register-link">
      Нет аккаунта? <a href="https://www.galardro.org/" target="_blank">Зарегистрироваться</a>
    </div>
  </div>
</div>

<!-- Основной контент (скрыт до входа) -->
<div id="mainContent" style="display: none;">
  <!-- Хедер с балансом -->
  <div class="header-bar">
    <div class="balance-info">
      <div class="balance-item">
        <span class="balance-label">Баланс:</span>
        <span class="balance-value" id="balanceValue">0.00 USDT</span>
      </div>
      <div class="balance-item">
        <span class="balance-label">Кредит:</span>
        <span class="balance-value">0.00 USDT</span>
      </div>
      <div class="balance-item">
        <span class="balance-label">PnL:</span>
        <span class="balance-value positive" id="pnlValue">+0.00%</span>
      </div>
    </div>
    <div class="user-menu">
      <span id="userLevel">Уровень: 1</span>
    </div>
  </div>

  <!-- Основной контейнер -->
  <div class="main-container">
    <!-- Левая колонка с рыночными данными -->
    <div class="market-column">
      <!-- Список избранных активов -->
      <div class="watchlist-section">
        <div class="section-title">
          <span>Избранные активы</span>
        </div>
        <div id="watchlist">
          <!-- Активы будут добавлены через JavaScript -->
        </div>
      </div>

      <!-- Быстрые кнопки -->
      <div class="quick-buttons-section">
        <div class="section-title">Быстрый доступ</div>
        <div class="quick-buttons">
          <div class="quick-btn" onclick="selectAsset('BTC')">BTC/USDT</div>
          <div class="quick-btn" onclick="selectAsset('ETH')">ETH/USDT</div>
          <div class="quick-btn" onclick="selectAsset('AAPL')">AAPL</div>
          <div class="quick-btn" onclick="selectAsset('TSLA')">TSLA</div>
          <div class="quick-btn" onclick="selectAsset('NVDA')">NVDA</div>
          <div class="quick-btn" onclick="selectAsset('MSFT')">MSFT</div>
        </div>
      </div>

      <!-- Обзор портфеля -->
      <div class="portfolio-section">
        <div class="section-title">Обзор портфеля</div>
        <div class="portfolio-item">
          <span>Акции</span>
          <span>65%</span>
        </div>
        <div class="portfolio-bar">
          <div class="portfolio-fill" style="width: 65%; background: #1f6feb;"></div>
        </div>
        <div class="portfolio-item">
          <span>Крипто</span>
          <span>25%</span>
        </div>
        <div class="portfolio-bar">
          <div class="portfolio-fill" style="width: 25%; background: #16c784;"></div>
        </div>
        <div class="portfolio-item">
          <span>Фьючерсы</span>
          <span>10%</span>
        </div>
        <div class="portfolio-bar">
          <div class="portfolio-fill" style="width: 10%; background: #ea3943;"></div>
        </div>
      </div>

      <!-- Рыночные данные -->
      <div class="market-data-section">
        <div class="section-title">Рыночные данные</div>
        <div class="market-stats">
          <div class="stat-item">
            <div class="stat-value" id="btcDominance">42.8%</div>
            <div class="stat-label">Доминирование BTC</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="fearGreed">72</div>
            <div class="stat-label">Индекс страха</div>
          </div>
        </div>
        <div class="market-stats">
          <div class="stat-item">
            <div class="stat-value" id="totalMarketCap">2.11T</div>
            <div class="stat-label">Капитализация</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="volume24h">78.38B</div>
            <div class="stat-label">Объем 24ч</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Основной layout с меню и контентом -->
    <div class="layout">
      <!-- sidebar -->
      <div class="sidebar">
        <div class="sidebar-item active" onclick="showPage('trade')">
          <img src="https://img.icons8.com/ios-filled/24/ffffff/home.png" alt="" />
          <div>Торговля</div>
        </div>
        <div class="sidebar-item" onclick="showPage('profile')">
          <img src="https://img.icons8.com/ios-filled/24/ffffff/user-male-circle.png" alt="" />
          <div>Профиль</div>
        </div>
        <div class="sidebar-item" onclick="showPage('deposit')">
          <img src="https://img.icons8.com/ios-filled/24/ffffff/money-transfer.png" alt="" />
          <div>Депозит</div>
        </div>
        <div class="sidebar-item" onclick="showPage('withdraw')">
          <img src="https://img.icons8.com/ios-filled/24/ffffff/export.png" alt="" />
          <div>Вывод</div>
        </div>
        <div class="sidebar-item">
          <img src="https://img.icons8.com/ios-filled/24/ffffff/activity-history.png" alt="" />
          <div>История</div>
        </div>
      </div>

      <!-- Контент страниц -->
      
      <!-- Страница Торговля -->
      <div id="trade-page" class="page-content active">
        <div class="trade-layout">
          <div class="trade-main">
            <div class="chart-section">
              <div style="padding: 10px 15px; background: #161b22; border-bottom: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center;">
                <div style="font-weight: bold;">Apple Inc</div>
                <div style="font-size: 12px; color: #8b949e;" id="currentTime">02:04:37 1024.83 | 02:04:33 – 03:04 (+0.01%)</div>
              </div>
              <iframe id="chartFrame" src="https://www.tradingview.com/widgetembed/?symbol=AAPL&interval=1&theme=dark"></iframe>

              <!-- Кнопка для открытия истории позиций на мобильной -->
              <div class="mobile-positions-toggle">
                <div class="positions-title" onclick="togglePositions()">
                  История позиций
                </div>
                <div id="positionsContainer" class="positions-container">
                  <!-- Позиции будут добавляться здесь -->
                </div>
              </div>

              <!-- Отображение позиций в десктопной версии -->
              <div class="desktop-positions">
                <div class="positions-title">
                  История позиций
                </div>
                <div id="desktopPositionsContainer" class="positions-container">
                  <!-- Позиции будут добавляться здесь -->
                </div>
              </div>
            </div>
          </div>
          
          <div class="trade-terminal" id="tradeTerminal">
            <div class="terminal-section">
              <div class="title">Фьючерсный терминал</div>
              
              <!-- Селектор компании в терминале -->
              <div class="selector-container">
                <button class="selector-button" onclick="toggleDropdown()">Текущая компания: <span id="selectedCompany">AAPL</span> ▼</button>
                <div id="dropdown" class="dropdown">
                  <input type="text" placeholder="Поиск..." oninput="filterCompanies(this.value)" />
                  <div id="companyList"></div>
                </div>
              </div>
              
              <div class="market-info">
                <div>
                  <span>Цена:</span>
                  <span id="currentPrice">${(Math.random() * 100 + 50).toFixed(2)} USD</span>
                </div>
                <div>
                  <span>24h Объем:</span>
                  <span id="dailyVolume">${(Math.random() * 5000 + 1000).toFixed(0)} BTC</span>
                </div>
                <div>
                  <span>24h Изменение:</span>
                  <span id="dailyChange" style="color: ${Math.random() > 0.5 ? '#16c784' : '#ea3943'}">
                    ${(Math.random() * 10 - 5).toFixed(2)}%
                  </span>
                </div>
              </div>
              <select>
                <option>Лимитный</option>
                <option selected>Рыночный</option>
                <option>Триггер</option>
              </select>
              <div class="info-line">Режим активов: Один актив</div>
              <div class="info-line">Дост.: 0.0000 USDT</div>
              <input type="number" placeholder="Стоимость" />
              <select>
                <option selected>USDT</option>
                <option>BTC</option>
              </select>
              <label for="leverage">Кредитное плечо:</label>
              <input type="range" id="leverage" min="1" max="100" value="20" oninput="updateLeverage(this.value)">
              <div class="leverage-display" id="leverage-value">20x</div>
              <div class="checkbox-group">
                <label><input type="checkbox" onchange="toggleTPSL(this, 'tp-sl-long')"> Лонг т-п/с-л</label>
                <label><input type="checkbox" onchange="toggleTPSL(this, 'tp-sl-short')"> Шорт т-п/с-л</label>
              </div>
              <div id="tp-sl-long" class="tp-sl">
                <input type="number" placeholder="Лонг Take Profit (USDT)">
                <input type="number" placeholder="Лонг Stop Loss (USDT)">
              </div>
              <div id="tp-sl-short" class="tp-sl">
                <input type="number" placeholder="Шорт Take Profit (USDT)">
                <input type="number" placeholder="Шорт Stop Loss (USDT)">
              </div>
              <div class="info-line">Ожид. цена ликвидации (лонг): —</div>
              <div class="info-line">Ожид. цена ликвидации (шорт): —</div>
              <div class="flex-space">
                <button class="btn btn-long" onclick="openPosition('Лонг')">Открыть лонг</button>
                <button class="btn btn-short" onclick="openPosition('Шорт')">Открыть шорт</button>
              </div>
              <div class="info-line">Уровень комиссии</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Страница Профиль -->
      <div id="profile-page" class="page-content">
        <div class="profile-container">
          <h2>Профиль пользователя</h2>
          
          <div class="user-id">
            <span class="label">ID пользователя:</span>
            <span class="value">J58syuYkou97dkdjk9yt</span>
          </div>
          
          <div class="profile-section">
            <div class="profile-column">
              <h3>Настройки профиля</h3>
              
              <div class="info-row">
                <span class="label">Двухфакторная аутентификация</span>
                <button class="profile-btn btn-secondary" onclick="enable2FA()">Включить</button>
              </div>
              
              <div class="kyc-message">
                <p><strong>Верификация KYC</strong></p>
                <p>Для полного доступа к функциям платформы требуется пройти верификацию личности.</p>
                <p>После подачи заявки проверка займет до 48 часов.</p>
              </div>
              
              <button class="profile-btn btn-kyc" onclick="showKycMessage()">Пройти верификацию KYC</button>
              
              <div class="info-row">
                <span class="label">Статус верификации:</span>
                <span class="status-badge status-pending">Частично верифицирован</span>
              </div>
            </div>
            
            <div class="profile-column">
              <h3>Личная информация</h3>
              <p style="color: #8b949e; margin-bottom: 15px; font-size: 14px;">Данные будут доступны после KYC верификации</p>
              
              <div class="info-row">
                <span class="label">Имя:</span>
                <span class="value">—</span>
              </div>
              
              <div class="info-row">
                <span class="label">Фамилия:</span>
                <span class="value">—</span>
              </div>
              
              <div class="info-row">
                <span class="label">Страна:</span>
                <span class="value">—</span>
              </div>
              
              <div class="info-row">
                <span class="label">Город:</span>
                <span class="value">—</span>
              </div>
              
              <div class="info-row">
                <span class="label">Адрес:</span>
                <span class="value">—</span>
              </div>
              
              <div class="info-row">
                <span class="label">Почтовый индекс:</span>
                <span class="value">—</span>
              </div>
              
              <div class="info-row">
                <span class="label">Дата рождения:</span>
                <span class="value">—</span>
              </div>
            </div>
          </div>

          <div class="profile-section">
            <div class="profile-column">
              <h3>Подтверждение личности</h3>
              
              <div class="file-upload">
                <label for="passport-front">Паспорт (главная страница)</label>
                <input type="file" id="passport-front" class="file-input" />
              </div>
              
              <div class="file-upload">
                <label for="passport-selfie">Селфи с паспортом</label>
                <input type="file" id="passport-selfie" class="file-input" />
              </div>
              
              <div class="file-upload">
                <label for="address-proof">Подтверждение адреса</label>
                <input type="file" id="address-proof" class="file-input" />
              </div>
            </div>
            
            <div class="profile-column">
              <h3>Платёжные данные</h3>
              
              <div class="file-upload">
                <label for="dod">DoD документ</label>
                <input type="file" id="dod" class="file-input" />
              </div>
              
              <div class="file-upload">
                <label for="utility-bill">Utility bill</label>
                <input type="file" id="utility-bill" class="file-input" />
              </div>
              
              <div class="file-upload">
                <label for="wire-transfer">Wire transfer swift</label>
                <input type="file" id="wire-transfer" class="file-input" />
              </div>
              
              <div class="file-upload">
                <label for="card-front">Лицевая сторона карты</label>
                <input type="file" id="card-front" class="file-input" />
              </div>
              
              <div class="file-upload">
                <label for="card-back">Обратная сторона карты</label>
                <input type="file" id="card-back" class="file-input" />
              </div>
              
              <div class="file-upload">
                <label for="payment-proof">Подтверждение платежа</label>
                <input type="file" id="payment-proof" class="file-input" />
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Страница Депозит -->
      <div id="deposit-page" class="page-content">
        <h1>Баланс</h1>
        
        <!-- Главный баланс как на реальной бирже -->
        <div class="total-balance">
          <div class="total-balance-label">Общий баланс</div>
          <div class="total-balance-amount" id="depositTotalBalance">0.00<span class="balance-currency">USDT</span></div>
        </div>

        <div class="balance-warning">
          В связи с безопасностью детали баланса скрыты до прохождения KYC верификации
        </div>

        <div class="available-balance">
          <div class="available-balance-label">Доступно для торговли</div>
          <div class="available-balance-amount" id="availableBalance">0.00 USDT</div>
        </div>
        
        <div class="balance-info-section">
          <div class="wallet-tabs">
            <div class="wallet-tab" data-wallet="btc">BTC</div>
            <div class="wallet-tab" data-wallet="eth">ETH</div>
            <div class="wallet-tab active" data-wallet="usdt-erc20">USDT ERC20</div>
            <div class="wallet-tab" data-wallet="usdt-trc20">USDT TRC20</div>
          </div>
          
          <!-- Кошельки -->
          <div id="btc-wallet" class="wallet-content">
            <div class="qr-code-container">
              <div class="qr-code">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=3FZbgi29pgTQ3KJJeuZPbQYJBJfZ4qJwYt" alt="BTC QR Code">
              </div>
              <div class="wallet-address">3FZbgi29pgTQ3KJJeuZPbQYJBJfZ4qJwYt</div>
              <div class="network-info">Bitcoin Network</div>
              <div class="wallet-buttons">
                <button class="wallet-btn copy-btn">Копировать адрес</button>
              </div>
            </div>
          </div>
          
          <div id="eth-wallet" class="wallet-content">
            <div class="qr-code-container">
              <div class="qr-code">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=0x71C7656EC7ab88b098defB751B7401B5f6d8976F" alt="ETH QR Code">
              </div>
              <div class="wallet-address">0x71C7656EC7ab88b098defB751B7401B5f6d8976F</div>
              <div class="network-info">Ethereum Network (ERC20)</div>
              <div class="wallet-buttons">
                <button class="wallet-btn copy-btn">Копировать адрес</button>
              </div>
            </div>
          </div>
          
          <div id="usdt-erc20-wallet" class="wallet-content active">
            <div class="qr-code-container">
              <div class="qr-code">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=TRWAUKg2yw1QRFh9TTsGvSJudyHACHzyJ3" alt="USDT ERC20 QR Code">
              </div>
              <div class="wallet-address">TRWAUKg2yw1QRFh9TTsGvSJudyHACHzyJ3</div>
              <div class="network-info">Ethereum Network (ERC20)</div>
              <div class="wallet-buttons">
                <button class="wallet-btn copy-btn">Копировать адрес</button>
              </div>
            </div>
          </div>
          
          <div id="usdt-trc20-wallet" class="wallet-content">
            <div class="qr-code-container">
              <div class="qr-code">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=TRWAUKg2yw1QRFh9TTsGvSJudyHACHzyJ3" alt="USDT TRC20 QR Code">
              </div>
              <div class="wallet-address">TRWAUKg2yw1QRFh9TTsGvSJudyHACHzyJ3</div>
              <div class="network-info">Tron Network (TRC20)</div>
              <div class="wallet-buttons">
                <button class="wallet-btn copy-btn">Копировать адрес</button>
              </div>
            </div>
          </div>
        </div>

        <div class="history-section">
          <h2>История транзакций</h2>
          <table class="history-table">
            <thead>
              <tr>
                <th>Дата</th>
                <th>Сумма</th>
                <th>Описание</th>
                <th>Счёт</th>
                <th>Тип</th>
                <th>Статус</th>
              </tr>
            </thead>
            <tbody>
              <tr class="empty-history">
                <td colspan="6">Нет данных о транзакциях</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Страница Вывод -->
      <div id="withdraw-page" class="page-content">
        <h1>Вывод средств</h1>

        <!-- Главный баланс как на реальной бирже -->
        <div class="total-balance">
          <div class="total-balance-label">Доступно для вывода</div>
          <div class="total-balance-amount" id="withdrawTotalBalance">0.00<span class="balance-currency">USDT</span></div>
        </div>

        <div class="withdraw-alert">
          В связи с безопасностью детали баланса скрыты до прохождения KYC верификации
        </div>

        <div class="balance-display">
          <div class="balance-row">
            <span class="balance-label">Общий баланс</span>
            <span class="balance-amount" id="withdrawBalanceTotal">0.00 USDT</span>
          </div>
          <div class="balance-row">
            <span class="balance-label">Доступно для вывода</span>
            <span class="balance-amount" id="withdrawBalanceAvailable">0.00 USDT</span>
          </div>
          <div class="balance-row">
            <span class="balance-label">В ордерах</span>
            <span class="balance-amount">0.00 USDT</span>
          </div>
        </div>

        <div class="withdraw-form">
          <div class="withdraw-tabs">
            <div class="withdraw-tab active" onclick="switchWithdrawTab('bank')">Банковская карта</div>
            <div class="withdraw-tab" onclick="switchWithdrawTab('crypto')">Криптовалюта</div>
          </div>

          <div id="bank" class="form-section active">
            <div class="form-group">
              <label for="card-number">Номер карты</label>
              <input type="text" id="card-number" placeholder="0000 0000 0000 0000" />
            </div>
            <div class="form-group">
              <label for="card-holder">Имя владельца карты</label>
              <input type="text" id="card-holder" placeholder="IVAN IVANOV" />
            </div>
            <div class="form-group">
              <label for="withdraw-amount-bank">Сумма вывода (USDT)</label>
              <input type="text" id="withdraw-amount-bank" placeholder="0.00" />
            </div>
            <button class="submit-btn" onclick="showVipModal()">Вывести средства</button>
          </div>

          <div id="crypto" class="form-section">
            <div class="form-group">
              <label for="wallet-address">Адрес кошелька</label>
              <input type="text" id="wallet-address" placeholder="0x..." />
            </div>
            <div class="form-group">
              <label for="withdraw-amount-crypto">Сумма в USDT</label>
              <input type="text" id="withdraw-amount-crypto" placeholder="0.00" />
            </div>
            <button class="submit-btn" onclick="showCommissionModal()">Отправить криптовалюту</button>
          </div>
        </div>

        <div class="history-section">
          <h2>История транзакций</h2>
          <table class="history-table">
            <thead>
              <tr>
                <th>Дата</th>
                <th>Валюта</th>
                <th>Описание</th>
                <th>Сумма</th>
                <th>Статус</th>
              </tr>
            </thead>
            <tbody>
              <tr class="empty-history">
                <td colspan="5">Нет данных о транзакциях</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Модальные окна для Вывода -->
<div class="modal-overlay" id="vipModal">
  <div class="modal">
    <div class="modal-header">
      <h3>Доступ ограничен</h3>
      <button class="modal-close" onclick="closeVipModal()">×</button>
    </div>
    <div class="modal-body">
      <div class="modal-message">
        <p>Вывод на банковскую карту доступен только для VIP-пользователей.</p>
        <p>Для получения VIP-статуса обратитесь в службу поддержки.</p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn modal-btn-cancel" onclick="closeVipModal()">Закрыть</button>
      <button class="modal-btn modal-btn-confirm" onclick="closeVipModal()">Понятно</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="commissionModal">
  <div class="modal">
    <div class="modal-header">
      <h3>Внимание: Высокие комиссии</h3>
      <button class="modal-close" onclick="closeCommissionModal()">×</button>
    </div>
    <div class="modal-body">
      <div class="modal-message">
        <p>Информируем Вас о комиссиях при выводе средств.</p>
        
        <div class="commission-warning">
          <p><strong>Комиссия за вывод: 40%</strong></p>
          <p>Причина применения:</p>
          <ul class="commission-list">
            <li>• Отсутствием пройденной процедуры KYC-верификации;</li>
            <li>• Действием стартового тарифного плана (при депозите менее 1 000 USDT).</li>
          </ul>
        </div>

        <p><strong>Дополнительно:</strong> Биржа-получатель может удержать до 40% от суммы перевода согласно своим тарифам.</p>
        
        <p class="commission-total">Общие расходы на комиссию составят от 40% до 80% от запрашиваемой суммы.</p>
      </div>

      <div class="checkbox-container">
        <input type="checkbox" id="agreeCheckbox" onchange="toggleContinueButton()">
        <label for="agreeCheckbox" class="checkbox-label">
          Я соглашаюсь с тем что расходы на комиссию составят от 40% до 80% от суммы вывода
        </label>
      </div>

      <div id="supportMessage" class="support-message" style="display: none;">
        <p>Свяжитесь с поддержкой для подтверждения личности</p>
        <button class="modal-btn modal-btn-confirm" onclick="closeCommissionModal()">Закрыть</button>
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn modal-btn-cancel" onclick="closeCommissionModal()">Отмена</button>
      <button class="modal-btn modal-btn-confirm" id="continueBtn" onclick="showSupportMessage()" disabled>Продолжить</button>
    </div>
  </div>
</div>

<!-- НОВОЕ МОДАЛЬНОЕ ОКНО ДЛЯ ТИПА REQUEST -->
<div class="modal-overlay" id="requestModal">
  <div class="modal">
    <div class="modal-header">
      <h3>Запрос на вывод средств</h3>
      <button class="modal-close" onclick="closeRequestModal()">×</button>
    </div>
    <div class="modal-body">
      <div class="success-checkmark">
        <div class="check-icon">
          <span class="icon-line line-tip"></span>
          <span class="icon-line line-long"></span>
          <div class="icon-circle"></div>
          <div class="icon-fix"></div>
        </div>
      </div>
      
      <div class="modal-message" style="text-align: center;">
        <p style="font-size: 18px; font-weight: bold; color: #16c784; margin-bottom: 15px;">Запрос на вывод средств направлен</p>
        <p>Ваш запрос на вывод средств успешно отправлен в обработку.</p>
        <p>Стандартная комиссия за вывод составляет 1-3%.</p>
        <p>Обычное время обработки: 1-3 рабочих дня.</p>
        <p style="margin-top: 20px; font-size: 14px; color: #8b949e;">Вы получите уведомление по завершении операции.</p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn modal-btn-confirm" onclick="closeRequestModal()">Понятно</button>
    </div>
  </div>
</div>

<div class="toast" id="toast">Ошибка! Пожалуйста, попробуйте позже.</div>

<script>
// =============================================
// ЦЕНТРАЛИЗОВАННАЯ СИСТЕМА УПРАВЛЕНИЯ ПОЛЬЗОВАТЕЛЯМИ
// =============================================

const usersData = {
    // ========================
    // БАЛАНСЫ ПОЛЬЗОВАТЕЛЕЙ
    // ========================
    
    // Редук 1 - основной аккаунт (ТИП REQUEST)
    "reduk1": { 
        password: "12345", 
        balance: "256.17",
        level: "VIP 1",
        withdrawType: "request" // НОВОЕ ПОЛЕ: commission или request
    },
    
    // Редук 2 - тестовый (ТИП COMMISSION)
    "reduk2": { 
        password: "12345", 
        balance: "0.00",
        level: "Стандарт",
        withdrawType: "commission"
    },
    
    // Редук 3 - дополнительный (ТИП REQUEST)
    "reduk3": { 
        password: "12345", 
        balance: "0.00",
        level: "Стандарт",
        withdrawType: "request"
    },
    
    // Редук 4 - резервный (ТИП COMMISSION)
    "reduk4": { 
        password: "12345", 
        balance: "0.00",
        level: "Стандарт",
        withdrawType: "commission"
    },
    
    // Редук 5 - запасной (ТИП REQUEST)
    "reduk5": { 
        password: "12345", 
        balance: "0.00",
        level: "Стандарт",
        withdrawType: "request"
    },
    
    // Редук 6 - дополнительный (ТИП COMMISSION)
    "reduk6": { 
        password: "12345", 
        balance: "0.00",
        level: "Стандарт",
        withdrawType: "commission"
    },
    
    // ========================
    // ДОПОЛНИТЕЛЬНЫЕ ПОЛЬЗОВАТЕЛИ
    // ========================
    
    "reduk7": { 
        password: "12345", 
        balance: "150.00",
        level: "Стандарт",
        withdrawType: "request"
    },
    
    "reduk8": { 
        password: "12345", 
        balance: "75.50",
        level: "Стандарт",
        withdrawType: "commission"
    },
    
    "reduk9": { 
        password: "12345", 
        balance: "320.25",
        level: "VIP 1",
        withdrawType: "request"
    },
    
    "reduk10": { 
        password: "12345", 
        balance: "0.00",
        level: "Стандарт",
        withdrawType: "commission"
    },
    
    "reduk11": { 
        password: "12345", 
        balance: "500.00",
        level: "VIP 2",
        withdrawType: "request"
    },
    
    "reduk12": { 
        password: "12345", 
        balance: "45.75",
        level: "Стандарт",
        withdrawType: "commission"
    },
    
    "reduk13": { 
        password: "12345", 
        balance: "180.30",
        level: "Стандарт",
        withdrawType: "request"
    },
    
    "reduk14": { 
        password: "12345", 
        balance: "0.00",
        level: "Стандарт",
        withdrawType: "commission"
    },
    
    "reduk15": { 
        password: "12345", 
        balance: "750.80",
        level: "VIP 2",
        withdrawType: "request"
    },
    
    "reduk16": { 
        password: "12345", 
        balance: "25.00",
        level: "Стандарт",
        withdrawType: "commission"
    },
    
    "reduk17": { 
        password: "12345", 
        balance: "420.60",
        level: "VIP 1",
        withdrawType: "request"
    },
    
    "reduk18": { 
        password: "12345", 
        balance: "0.00",
        level: "Стандарт",
        withdrawType: "commission"
    },
    
    "reduk19": { 
        password: "12345", 
        balance: "95.25",
        level: "Стандарт",
        withdrawType: "request"
    },
    
    "reduk20": { 
        password: "12345", 
        balance: "1200.50",
        level: "VIP 3",
        withdrawType: "request"
    },
    
    "reduk21": { 
        password: "12345", 
        balance: "0.00",
        level: "Стандарт",
        withdrawType: "commission"
    },
    
    "reduk22": { 
        password: "12345", 
        balance: "65.80",
        level: "Стандарт",
        withdrawType: "request"
    },
    
    "reduk23": { 
        password: "12345", 
        balance: "280.40",
        level: "Стандарт",
        withdrawType: "commission"
    },
    
    "reduk24": { 
        password: "12345", 
        balance: "0.00",
        level: "Стандарт",
        withdrawType: "request"
    },
    
    "reduk25": { 
        password: "12345", 
        balance: "1500.75",
        level: "VIP 3",
        withdrawType: "request"
    },
    
    "reduk26": { 
        password: "12345", 
        balance: "35.20",
        level: "Стандарт",
        withdrawType: "commission"
    }
    
    // ========================
    // КОНЕЦ НАСТРОЕК БАЛАНСОВ
    // ========================
};

// Текущий пользователь
let currentUser = null;

// Функция для переключения отображения истории позиций на мобильной
function togglePositions() {
  const positionsContainer = document.getElementById('positionsContainer');
  const positionsTitle = document.querySelector('.positions-title');
  const tradeTerminal = document.getElementById('tradeTerminal');
  
  positionsContainer.classList.toggle('expanded');
  positionsTitle.classList.toggle('expanded');
  
  // На мобильных устройствах сдвигаем терминал вниз
  if (window.innerWidth <= 767) {
    tradeTerminal.classList.toggle('shifted');
  }
}

// Система навигации
function showPage(page) {
  document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
  
  document.getElementById(`${page}-page`).classList.add('active');
  event.currentTarget.classList.add('active');
  
  // Обновляем балансы при переключении страниц
  if (currentUser) {
    updateAllBalances();
  }
}

// Обновление всех балансов на страницах
function updateAllBalances() {
  if (!currentUser) return;
  
  const user = usersData[currentUser];
  const balance = user.balance;
  
  // Хедер
  document.getElementById('balanceValue').textContent = balance + ' USDT';
  
  // Депозит страница
  document.getElementById('depositTotalBalance').innerHTML = balance + '<span class="balance-currency">USDT</span>';
  document.getElementById('availableBalance').textContent = balance + ' USDT';
  
  // Вывод страница
  document.getElementById('withdrawTotalBalance').innerHTML = balance + '<span class="balance-currency">USDT</span>';
  document.getElementById('withdrawBalanceTotal').textContent = balance + ' USDT';
  document.getElementById('withdrawBalanceAvailable').textContent = balance + ' USDT';
  
  // Торговля страница
  const availableElement = document.querySelector('.info-line:nth-child(2)');
  if (availableElement) {
    availableElement.textContent = `Дост.: ${balance} USDT`;
  }
}

// Проверка входа
function checkLogin() {
  const login = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  const errorElement = document.getElementById('loginError');
  
  // Проверяем по нашим пользователям
  if (usersData[login] && usersData[login].password === password) {
    currentUser = login;
    localStorage.setItem('isLoggedIn', 'true');
    localStorage.setItem('currentUser', login);
    document.getElementById('loginContainer').style.display = 'none';
    document.getElementById('mainContent').style.display = 'block';
    updateUserData();
    updateAllBalances();
    initWatchlist();
    updateCurrentTime();
  } else {
    errorElement.style.display = 'block';
  }
}

// Обновление данных пользователя
function updateUserData() {
  if (!currentUser) return;
  
  const user = usersData[currentUser];
  const levelElement = document.getElementById('userLevel');
  
  // Обновляем уровень
  levelElement.textContent = `Уровень: ${user.level}`;
}

// Обновление информации в хедере
function updateBalanceInfo() {
  if (!currentUser) return;
  
  const balanceElement = document.getElementById('balanceValue');
  const pnlElement = document.getElementById('pnlValue');
  
  const pnlChange = (Math.random() * 2 - 1).toFixed(2);
  
  // Используем реальный баланс пользователя
  balanceElement.textContent = usersData[currentUser].balance + ' USDT';
  pnlElement.textContent = (pnlChange >= 0 ? '+' : '') + pnlChange + '%';
  pnlElement.className = pnlChange >= 0 ? 'balance-value positive' : 'balance-value negative';
  
  setTimeout(updateBalanceInfo, 5000);
}

// Обновление текущего времени
function updateCurrentTime() {
  const now = new Date();
  const timeString = now.toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit', second: '2-digit'});
  const dateString = now.toLocaleDateString('ru-RU');
  
  document.getElementById('currentTime').textContent = `${timeString} ${dateString} | ${timeString} – ${timeString} (+0.01%)`;
  setTimeout(updateCurrentTime, 1000);
}

// Проверяем, был ли пользователь уже авторизован
window.addEventListener('DOMContentLoaded', function() {
  const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
  const savedUser = localStorage.getItem('currentUser');
  
  if (isLoggedIn && savedUser && usersData[savedUser]) {
    currentUser = savedUser;
    document.getElementById('loginContainer').style.display = 'none';
    document.getElementById('mainContent').style.display = 'block';
    updateUserData();
    updateAllBalances();
    initWatchlist();
    updateCurrentTime();
  } else {
    document.getElementById('loginContainer').style.display = 'flex';
    document.getElementById('mainContent').style.display = 'none';
  }
});

// Проверка доступности localStorage
let storageAvailable = true;
try {
  const testKey = '__test';
  localStorage.setItem(testKey, '1');
  localStorage.removeItem(testKey);
} catch (e) {
  storageAvailable = false;
  alert("⚠️ Внимание: Ваш браузер блокирует сохранение данных. Сделки не будут сохраняться после перезагрузки.");
}

// Инициализация списка избранных активов
function initWatchlist() {
  const watchlist = [
    { symbol: 'BTC/USDT', price: 89962.22, change: 2.99 },
    { symbol: 'ETH/USDT', price: 9917.45, change: 1.15 },
    { symbol: 'AAPL', price: 790.12, change: 0.97 },
    { symbol: 'TSLA', price: 802.39, change: 3.86 },
    { symbol: 'NVDA', price: 4929.91, change: 1.00 },
    { symbol: 'MSFT', price: 739.59, change: 1.31 }
  ];
  
  const watchlistContainer = document.getElementById('watchlist');
  watchlistContainer.innerHTML = '';
  
  watchlist.forEach(asset => {
    const item = document.createElement('div');
    item.className = 'watchlist-item';
    item.onclick = () => selectAsset(asset.symbol.split('/')[0]);
    
    const changeClass = asset.change >= 0 ? 'positive' : 'negative';
    const changeSign = asset.change >= 0 ? '+' : '';
    
    item.innerHTML = `
      <div class="asset-name">${asset.symbol}</div>
      <div class="asset-price">${asset.price.toLocaleString()}</div>
      <div class="asset-change ${changeClass}">${changeSign}${asset.change}%</div>
    `;
    
    watchlistContainer.appendChild(item);
  });
  
  updateWatchlistPrices();
}

// Обновление цен в списке избранных активов
function updateWatchlistPrices() {
  const items = document.querySelectorAll('.watchlist-item');
  
  items.forEach(item => {
    const priceElement = item.querySelector('.asset-price');
    const changeElement = item.querySelector('.asset-change');
    
    if (priceElement && changeElement) {
      const currentPrice = parseFloat(priceElement.textContent.replace(/,/g, ''));
      const currentChange = parseFloat(changeElement.textContent);
      
      const priceChange = (Math.random() * 10 - 5) / 100;
      const newPrice = currentPrice * (1 + priceChange / 100);
      const newChange = currentChange + priceChange;
      
      priceElement.textContent = newPrice.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
      changeElement.textContent = (newChange >= 0 ? '+' : '') + newChange.toFixed(2) + '%';
      changeElement.className = `asset-change ${newChange >= 0 ? 'positive' : 'negative'}`;
    }
  });
  
  updateMarketData();
  setTimeout(updateWatchlistPrices, 3000);
}

// Обновление рыночных данных
function updateMarketData() {
  const priceElement = document.getElementById('currentPrice');
  const volumeElement = document.getElementById('dailyVolume');
  const changeElement = document.getElementById('dailyChange');
  
  if (priceElement) {
    const currentPrice = parseFloat(priceElement.textContent.split(' ')[0]);
    const newPrice = (currentPrice + (Math.random() * 0.5 - 0.25)).toFixed(2);
    priceElement.textContent = `${newPrice} USD`;
    priceElement.style.color = newPrice > currentPrice ? '#16c784' : '#ea3943';
    setTimeout(() => priceElement.style.color = '#c9d1d9', 500);
  }
  
  if (volumeElement) {
    const currentVolume = parseFloat(volumeElement.textContent);
    const newVolume = (currentVolume + (Math.random() * 100 - 50)).toFixed(0);
    volumeElement.textContent = `${Math.abs(newVolume)} BTC`;
  }
  
  if (changeElement) {
    const currentChange = parseFloat(changeElement.textContent);
    const newChange = (currentChange + (Math.random() * 0.5 - 0.25)).toFixed(2);
    changeElement.textContent = `${newChange}%`;
    changeElement.style.color = newChange >= 0 ? '#16c784' : '#ea3943';
  }
  
  const btcDominance = document.getElementById('btcDominance');
  const fearGreed = document.getElementById('fearGreed');
  const totalMarketCap = document.getElementById('totalMarketCap');
  const volume24h = document.getElementById('volume24h');
  
  if (btcDominance) {
    const currentBtcDom = parseFloat(btcDominance.textContent);
    const newBtcDom = (currentBtcDom + (Math.random() * 0.2 - 0.1)).toFixed(1);
    btcDominance.textContent = `${newBtcDom}%`;
  }
  
  if (fearGreed) {
    const currentFearGreed = parseInt(fearGreed.textContent);
    const newFearGreed = Math.max(0, Math.min(100, currentFearGreed + Math.floor(Math.random() * 5 - 2)));
    fearGreed.textContent = newFearGreed;
    fearGreed.style.color = newFearGreed > 50 ? '#16c784' : newFearGreed > 25 ? '#ffcc00' : '#ea3943';
  }
}

// Выбор актива из быстрого доступа или списка избранных
function selectAsset(symbol) {
  document.getElementById("selectedCompany").textContent = symbol;
  document.getElementById("companyTitle").textContent = symbol;
  
  const overrides = {
    "BTC": "BINANCE:BTCUSDT",
    "ETH": "BINANCE:ETHUSDT",
    "AAPL": "NASDAQ:AAPL",
    "MSFT": "NASDAQ:MSFT",
    "GOOGL": "NASDAQ:GOOGL",
    "AMZN": "NASDAQ:AMZN",
    "TSLA": "NASDAQ:TSLA",
    "SHEL": "NYSE:SHEL",
    "NVDA": "NASDAQ:NVDA",
    "META": "NASDAQ:META",
    "NFLX": "NASDAQ:NFLX",
    "INTC": "NASDAQ:INTC",
    "AMD": "NASDAQ:AMD",
    "BABA": "NYSE:BABA",
    "ORCL": "NYSE:ORCL",
    "CRM": "NYSE:CRM",
    "ADBE": "NASDAQ:ADBE",
    "QCOM": "NASDAQ:QCOM",
    "UBER": "NYSE:UBER",
    "PYPL": "NASDAQ:PYPL",
    "T": "NYSE:T",
    "DIS": "NYSE:DIS",
    "KO": "NYSE:KO",
    "PEP": "NASDAQ:PEP",
    "WMT": "NYSE:WMT",
    "MCD": "NYSE:MCD",
    "XOM": "NYSE:XOM",
    "CVX": "NYSE:CVX",
    "BA": "NYSE:BA"
  };
  
  const tvSymbol = overrides[symbol] || `NASDAQ:${symbol}`;
  document.getElementById("chartFrame").onerror = () => {
    document.getElementById("chartFrame").style.display = 'none';
    alert("⚠️ График недоступен для этого актива");
  };

  document.getElementById("chartFrame").style.display = 'block';
  document.getElementById("chartFrame").src = `https://www.tradingview.com/widgetembed/?symbol=${tvSymbol}&interval=1&theme=dark`;
  updateMarketData();
}

setInterval(updateMarketData, 2000);

function updateLeverage(val) {
  document.getElementById("leverage-value").textContent = val + "x";
}

const companies = [
  "AAPL", "MSFT", "GOOGL", "AMZN", "TSLA", "SHEL", "NVDA", "META",
  "NFLX", "INTC", "AMD", "BABA", "ORCL", "CRM", "ADBE", "QCOM", "UBER",
  "PYPL", "T", "DIS", "KO", "PEP", "WMT", "MCD", "XOM", "CVX", "BA"
];

function toggleDropdown() {
  const dropdown = document.getElementById("dropdown");
  dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
  if (dropdown.style.display === "block") {
    filterCompanies("");
    document.getElementById("dropdown").querySelector("input").focus();
  }
}

function filterCompanies(search = "") {
  const filtered = companies.filter(c => c.toLowerCase().includes(search.toLowerCase()));
  const companyList = document.getElementById("companyList");
  companyList.innerHTML = "";
  filtered.forEach(company => {
    const div = document.createElement("div");
    div.textContent = company;
    div.onclick = () => selectAsset(company);
    companyList.appendChild(div);
  });
}

document.addEventListener("click", function(e) {
  if (!e.target.closest(".selector-container")) {
    document.getElementById("dropdown").style.display = "none";
  }
});

function openPosition(type) {
  if (!currentUser) return;
  
  const savedDeals = storageAvailable ? JSON.parse(localStorage.getItem("deals") || "[]") : [];
  const company = document.getElementById("selectedCompany").textContent;
  const leverage = document.getElementById("leverage").value;
  const amountInput = document.querySelector('input[type="number"]').value || 0;

  const dealBlock = document.createElement("div");
  dealBlock.className = "deal-block";

  const directionColor = type === "Лонг" ? "#16c784" : "#ea3943";

  dealBlock.innerHTML = `
    <div><strong>${company}USDT</strong> <span style="color:${directionColor}">${type}</span> <span>Кросс</span> <span>${leverage}x</span></div>
    <div class="deal-row">
      <div class="deal-column">
        <div>Ср. цена открытия: <span>${(Math.random() * 5 + 1).toFixed(4)}</span> USDT</div>
      </div>
      <div class="deal-column">
        <div>Всего открыто: <span>${parseFloat(amountInput).toFixed(2)}</span> USDT</div>
      </div>
      <div class="deal-column">
        <div>П/У позиции: <span class="profit">—</span> USDT</div>
        <div>Реализованная П/У: <span class="realized">—</span> USDT</div>
      </div>
    </div>
  `;

  // Добавляем позицию в оба контейнера (мобильный и десктопный)
  const mobileContainer = document.getElementById("positionsContainer");
  const desktopContainer = document.getElementById("desktopPositionsContainer");
  
  const mobileDealBlock = dealBlock.cloneNode(true);
  const desktopDealBlock = dealBlock.cloneNode(true);
  
  mobileContainer.prepend(mobileDealBlock);
  desktopContainer.prepend(desktopDealBlock);
  
  // Ограничиваем количество отображаемых позиций
  while (mobileContainer.children.length > 5) {
    mobileContainer.removeChild(mobileContainer.lastChild);
  }
  while (desktopContainer.children.length > 5) {
    desktopContainer.removeChild(desktopContainer.lastChild);
  }

  const timestamp = Date.now();
  const tp = type === 'Лонг' ? document.querySelector('#tp-sl-long input[placeholder*="Take"]')?.value : document.querySelector('#tp-sl-short input[placeholder*="Take"]')?.value;
  const sl = type === 'Лонг' ? document.querySelector('#tp-sl-long input[placeholder*="Stop"]')?.value : document.querySelector('#tp-sl-short input[placeholder*="Stop"]')?.value;
  const timeOpened = new Date().toLocaleTimeString();

  const dealData = {
    company,
    leverage,
    type,
    amount: parseFloat(amountInput).toFixed(2),
    openPrice: (Math.random() * 5 + 1).toFixed(4),
    tp,
    sl,
    timeOpened,
    timestamp
  };
  
  savedDeals.unshift(dealData);
  if (storageAvailable) {
    const trimmedDeals = savedDeals.slice(0, 5);
    localStorage.setItem("deals", JSON.stringify(trimmedDeals));
  }

  const tpInfo = tp ? `TP: ${tp}` : 'TP: —';
  const slInfo = sl ? `SL: ${sl}` : 'SL: —';
  const timeInfo = `Время открытия: ${timeOpened}`;

  const infoColumn = document.createElement('div');
  infoColumn.className = 'deal-column';
  infoColumn.innerHTML = `<div>${tpInfo}</div><div>${slInfo}</div><div>${timeInfo}</div>`;
  
  mobileDealBlock.querySelector('.deal-row').appendChild(infoColumn.cloneNode(true));
  desktopDealBlock.querySelector('.deal-row').appendChild(infoColumn.cloneNode(true));

  updateBalanceInfo();
}

function toggleTPSL(checkbox, targetId) {
  const target = document.getElementById(targetId);
  target.style.display = checkbox.checked ? 'block' : 'none';
}

// Загрузка сделок из localStorage при старте
window.addEventListener("load", () => {
  if (storageAvailable) {
    let savedDeals = JSON.parse(localStorage.getItem("deals") || "[]");
    savedDeals = savedDeals.slice(0, 5);
    
    // Очищаем оба контейнера
    document.getElementById("positionsContainer").innerHTML = "";
    document.getElementById("desktopPositionsContainer").innerHTML = "";
    
    // Восстанавливаем позиции в оба контейнера
    savedDeals.forEach(deal => {
      restorePosition(deal);
    });
  }
  updateMarketData();
});

function restorePosition(deal) {
  const dealBlock = document.createElement("div");
  dealBlock.className = "deal-block";

  const directionColor = deal.type === "Лонг" ? "#16c784" : "#ea3943";

  dealBlock.innerHTML = `
    <div><strong>${deal.company}USDT</strong> <span style="color:${directionColor}">${deal.type}</span> <span>Кросс</span> <span>${deal.leverage}x</span></div>
    <div class="deal-row">
      <div class="deal-column">
        <div>Ср. цена открытия: <span>${deal.openPrice}</span> USDT</div>
      </div>
      <div class="deal-column">
        <div>Всего открыто: <span>${deal.amount}</span> USDT</div>
      </div>
      <div class="deal-column">
        <div>П/У позиции: <span class="profit">—</span> USDT</div>
        <div>Реализованная П/У: <span class="realized">—</span> USDT</div>
      </div>
    </div>
  `;

  // Добавляем в оба контейнера
  const mobileContainer = document.getElementById("positionsContainer");
  const desktopContainer = document.getElementById("desktopPositionsContainer");
  
  const mobileDealBlock = dealBlock.cloneNode(true);
  const desktopDealBlock = dealBlock.cloneNode(true);
  
  mobileContainer.prepend(mobileDealBlock);
  desktopContainer.prepend(desktopDealBlock);

  const tpInfo = deal.tp ? `TP: ${deal.tp}` : 'TP: —';
  const slInfo = deal.sl ? `SL: ${deal.sl}` : 'SL: —';
  const timeInfo = `Время открытия: ${deal.timeOpened}`;

  const infoColumn = document.createElement('div');
  infoColumn.className = 'deal-column';
  infoColumn.innerHTML = `<div>${tpInfo}</div><div>${slInfo}</div><div>${timeInfo}</div>`;
  
  mobileDealBlock.querySelector('.deal-row').appendChild(infoColumn.cloneNode(true));
  desktopDealBlock.querySelector('.deal-row').appendChild(infoColumn.cloneNode(true));
}

// Функции для страницы Профиль
function showKycMessage() {
  alert("В связи с безопасностью KYC верификацию можно будет пройти только после 48 дней после регистрации\n\nДо прохождения верификации вам будут доступны все базовые функции биржи\n\nНекоторые функции будет скрыты на сайте, но будут поступать вам на почту\n\nПриятной торговли");
}

function changePassword() {
  alert("Функция изменения пароля временно недоступна. Для смены пароля обратитесь в службу поддержки.");
}

function enable2FA() {
  alert("Двухфакторная аутентификация будет доступна после прохождения KYC верификации.");
}

// Функции для страницы Депозит
document.addEventListener('DOMContentLoaded', function() {
  const walletTabs = document.querySelectorAll('.wallet-tab');
  walletTabs.forEach(tab => {
    tab.addEventListener('click', function() {
      walletTabs.forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      
      document.querySelectorAll('.wallet-content').forEach(content => {
        content.classList.remove('active');
      });
      
      const walletId = this.getAttribute('data-wallet');
      document.getElementById(`${walletId}-wallet`).classList.add('active');
    });
  });

  document.querySelectorAll('.copy-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const address = this.closest('.qr-code-container').querySelector('.wallet-address').textContent;
      navigator.clipboard.writeText(address)
        .then(() => {
          const originalText = this.textContent;
          this.textContent = '✓ Скопировано';
          this.classList.add('copied');
          
          setTimeout(() => {
            this.textContent = originalText;
            this.classList.remove('copied');
          }, 2000);
        })
        .catch(err => {
          console.error('Ошибка копирования: ', err);
          const textArea = document.createElement('textarea');
          textArea.value = address;
          document.body.appendChild(textArea);
          textArea.select();
          try {
            document.execCommand('copy');
            const originalText = this.textContent;
            this.textContent = '✓ Скопировано';
            this.classList.add('copied');
            
            setTimeout(() => {
              this.textContent = originalText;
              this.classList.remove('copied');
            }, 2000);
          } catch (fallbackErr) {
            alert('Не удалось скопировать адрес. Скопируйте вручную.');
          }
          document.body.removeChild(textArea);
        });
    });
  });
});

// Функции для страницы Вывод
function switchWithdrawTab(type) {
  document.querySelectorAll('.withdraw-tab').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.form-section').forEach(sec => sec.classList.remove('active'));

  document.querySelector(`.withdraw-tab[onclick="switchWithdrawTab('${type}')"]`).classList.add('active');
  document.getElementById(type).classList.add('active');
}

function showVipModal() {
  document.getElementById('vipModal').classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeVipModal() {
  document.getElementById('vipModal').classList.remove('active');
  document.body.style.overflow = 'auto';
}

// НОВАЯ ФУНКЦИЯ ДЛЯ ОБРАБОТКИ ВЫВОДА С УЧЕТОМ ТИПА ПОЛЬЗОВАТЕЛЯ
function showCommissionModal() {
  if (!currentUser) return;
  
  const user = usersData[currentUser];
  
  // Проверяем тип вывода пользователя
  if (user.withdrawType === "request") {
    showRequestModal();
  } else {
    showCommissionModalOld();
  }
}

// СТАРАЯ ФУНКЦИЯ КОМИССИИ (переименована)
function showCommissionModalOld() {
  document.getElementById('commissionModal').classList.add('active');
  document.body.style.overflow = 'hidden';
  document.getElementById('agreeCheckbox').checked = false;
  document.getElementById('continueBtn').disabled = true;
  document.getElementById('supportMessage').style.display = 'none';
  document.querySelector('.checkbox-container').style.display = 'flex';
  document.querySelector('.modal-footer').style.display = 'flex';
}

// НОВАЯ ФУНКЦИЯ ДЛЯ ТИПА REQUEST
function showRequestModal() {
  document.getElementById('requestModal').classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeRequestModal() {
  document.getElementById('requestModal').classList.remove('active');
  document.body.style.overflow = 'auto';
}

function closeCommissionModal() {
  document.getElementById('commissionModal').classList.remove('active');
  document.body.style.overflow = 'auto';
}

function toggleContinueButton() {
  const checkbox = document.getElementById('agreeCheckbox');
  const continueBtn = document.getElementById('continueBtn');
  continueBtn.disabled = !checkbox.checked;
}

function showSupportMessage() {
  document.querySelector('.checkbox-container').style.display = 'none';
  document.querySelector('.modal-footer').style.display = 'none';
  document.getElementById('supportMessage').style.display = 'block';
}

function showError() {
  const toast = document.getElementById("toast");
  toast.style.display = "block";
  setTimeout(() => {
    toast.style.display = "none";
  }, 4000);
}

// Закрытие модальных окон при клике вне окна
document.addEventListener('click', function(event) {
  const vipModal = document.getElementById('vipModal');
  const commissionModal = document.getElementById('commissionModal');
  const requestModal = document.getElementById('requestModal');
  
  if (event.target === vipModal) {
    closeVipModal();
  }
  if (event.target === commissionModal) {
    closeCommissionModal();
  }
  if (event.target === requestModal) {
    closeRequestModal();
  }
});

// Закрытие модальных окон при нажатии Escape
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    closeVipModal();
    closeCommissionModal();
    closeRequestModal();
  }
});
</script>
</body>
</html>